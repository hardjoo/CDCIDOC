pipeline {
    
agent any  
tools {   //using plugins
  nodejs 'nodejs20'
  dockerTool 'docker'

}
stages{
    stage("git clone"){
        steps{
       git branch:'main', url:'https://github.com/aymenellouze/CI-CD-Documentation.git'
        }
    }
    
      stage("install dependencies"){
        steps{
     
           
           sh 'npm install'
       
        }
    }
stage('sonarqube'){
            agent { 
                docker { 
                    image 'sonarsource/sonar-scanner-cli' 
                    args '-v /var/run/docker.sock:/var/run/docker.sock --network cicddoc_hardjo'
                } 
            }
            steps{             
             sh '''
              sonar-scanner \
               -Dsonar.projectKey=sonar \
               -Dsonar.sources=./src \
               -Dsonar.host.url=http://sonarqube:9000 \
                -Dsonar.login=admin \
                -Dsonar.password=hardjo1405
             '''
                }
            
        }
      stage("build the project"){
        steps{

            sh 'npm run build'
          
       
        }
    }
    stage("docker build"){
        steps{

            sh '''
            
             docker build -t prod .
            '''          
       
        }
    }


    
    stage("docker push to nexus"){
        steps{

            sh '''
            
            
            '''
          

       
        }
        
    }
}
    
}